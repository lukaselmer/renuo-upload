var RenuoUpload,bind=function(e,t){return function(){return e.apply(t,arguments)}};RenuoUpload=function(){function e(e,t,n){this.element=e,this.dropzoneOptions=t,this.callback=n,this._initializeOptions=bind(this._initializeOptions,this),this._initializeDropzone=bind(this._initializeDropzone,this),this._checkRequirements(),this._initializeOptions(),this._checkAdaptParams(),jQuery.when(this._getUploadInfoAndSignature()).done(this._initializeDropzone)}return e.prototype._initializeDropzone=function(){var e;return Dropzone.autoDiscover=!1,jQuery(this.element).addClass("dropzone"),e=new Dropzone(this.element,this.dropzoneOptions),e.on("success",function(e){return function(t){return e.callback(e._buildResult(t))}}(this)),e.on("error",function(){})},e.prototype._initializeOptions=function(){return this.apiKey=jQuery(this.element).data("apikey"),this.signingUrl=jQuery(this.element).data("signingurl")},e.prototype._cleanFilename=function(e){return e.toLowerCase().replace(/[ _]/g,"-").replace(/[^\w-.]/g,"")},e.prototype._getExtension=function(e){return e.split(".").pop()},e.prototype._getShortName=function(e){return e.replace(/\.[^\/.]+$/,"")},e.prototype._getPublicUrl=function(e){return""+this.fileUrlPath+e},e.prototype._getFilePath=function(e){return""+this.filePrefix+e},e.prototype._getUploadInfoAndSignature=function(){return jQuery.ajax({type:"POST",url:this.signingUrl,data:{api_key:this.apiKey},dataType:"json"}).done(function(e){return function(t){return e.dropzoneOptions.url=t.url,e.dropzoneOptions.params={},jQuery.each(t.data,function(t,n){return e.dropzoneOptions.params[t.replace(/_/g,"-")]=n}),e.filePrefix=t.file_prefix,e.fileUrlPath=t.file_url_path}}(this)).fail(function(){throw new Error("Failed to get credential for upload.")})},e.prototype._buildResult=function(e){var t;return t=this._cleanFilename(e.name),{orginalName:e.name,cleanName:t,name:this._getShortName(t),extension:this._getExtension(e.name),size:e.size,publicUrl:this._getPublicUrl(t),filePath:this._getFilePath(t)}},e.prototype._checkAdaptParams=function(){return this._checkElement(),this._adaptCallback(),this._adaptOptions()},e.prototype._checkRequirements=function(){if("undefined"==typeof jQuery||null===jQuery)throw new Error("RenuoUpload needs jQuery.");if("undefined"==typeof Dropzone||null===Dropzone)throw new Error("RenuoUpload needs Dropzone.")},e.prototype._checkElement=function(){if(null==this.element)throw new Error("Element is not defined");if(null!=this.element[0].nodeType&&(this.element=this.element[0]),null==this.element.nodeType)throw new Error("Element is not a valid element")},e.prototype._adaptOptions=function(){if(null==this.dropzoneOptions)throw new Error("DropzoneOptions is not defined");if(null==this.dropzoneOptions.acceptedFiles)throw new Error("DropzoneOptions.acceptedFiles is not defined");if("string"!=typeof this.dropzoneOptions.acceptedFiles)throw new Error("DropzoneOptions.acceptedFiles is not a string");return null==this.dropzoneOptions.parallelUploads&&(this.dropzoneOptions.parallelUploads=25),null==this.dropzoneOptions.renameFilename?this.dropzoneOptions.renameFilename=this._cleanFilename:void 0},e.prototype._adaptCallback=function(){return"function"!=typeof this.callback?this.callback=this._defaultCallback:void 0},e.prototype._defaultCallback=function(e){var t;return jQuery(this.element).parents("form").length?(t=e.name,delete e.name,jQuery.each(e,function(e){return function(n,i){return jQuery(e.element).parents("form").append("<input type='hidden' name='renuoupload["+t+"]["+n+"]' value='"+i+"'>")}}(this))):void 0},e}(),"undefined"!=typeof module&&null!==module?module.exports=RenuoUpload:window.RenuoUpload=RenuoUpload;